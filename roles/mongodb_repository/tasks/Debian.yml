---
# tasks file for mongodb_repository (Debian os_family)
- name: Install debian packages
  apt:
    name: "{{ debian_packages }}"
    state: present
  register: _apt
  until: _apt is succeeded
  retries: 5

- name: Add apt key for MongoDB repository
  apt_key:
    url: "{{ debian.apt_key_url }}"
    state: present
  register: _apt
  until: _apt is succeeded
  retries: 5

- set_fact:
    repo_opts: "{% if ansible_facts.distribution == 'Ubuntu' %} [ arch=amd64,arm64 ]{% endif %}"

- set_fact:
    component: "{% if ansible_facts.distribution == 'Ubuntu' %}multiverse{% else %}main{% endif %}"

- name: Ensure MongoDB apt repository exists
  apt_repository:
    repo: "{{ debian.apt_repository_repo }}"
    state: present
    filename: "mongodb-{{ mongodb_version }}"
  register: _apt
  until: _apt is succeeded
  retries: 5
