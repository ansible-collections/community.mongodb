---
# Tasks for for testing feature to solve Issue 436

- name: Insert a record into a collection
  community.mongodb.mongodb_shell:
    login_user: '{{ mongodb_admin_user }}'
    login_password: '{{ mongodb_admin_password }}'
    login_port: 3001
    debug: yes
    quiet: no
    db: "test"
    eval: 'db.hosts.insert({"_id": "first_record"})'
  register: first_insert

- assert:
    that: first_insert.changed

- name: Insert a duplicate record into a collection - shell does not throw an error so neither do we
  community.mongodb.mongodb_shell:
    login_user: '{{ mongodb_admin_user }}'
    login_password: '{{ mongodb_admin_password }}'
    login_port: 3001
    debug: yes
    quiet: no
    db: "test"
    eval: 'db.hosts.insert({"_id": "first_record"})'
  register: first_insert_duplicate

- assert:
    that: first_insert_duplicate.changed

- debug:
    var: first_insert_duplicate
